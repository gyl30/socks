# 安全设计

本项目以“最小暴露面、可控资源、可追踪审计”为原则，设计要点如下：

## 暴露面控制

1. 本地 SOCKS5 监听地址可配置，默认建议仅监听回环地址。
2. 监控接口仅允许本机访问，鉴权由 token 控制（按现有实现）。
3. 服务端对连接数与 stream 数量做上限控制，避免资源被耗尽。

## 认证与握手

1. 使用 REALITY 伪装握手对外观进行伪装。
2. 会话内使用派生密钥进行加密传输。
3. 对异常握手与重放行为进行检测并拒绝。

## 资源与并发限制

1. `max_connections` 限制服务端并发隧道数。
2. `max_streams` 限制单连接内 stream 数量。
3. `max_buffer` 限制 mux dispatcher 缓冲区，防止内存放大。
4. 写队列与缓冲溢出会触发连接关闭与 reset。

## 超时与空闲回收

1. TCP/UDP 会话均有空闲检测，超时会主动关闭。
2. 心跳与读写超时结合，保证连接不可长期占用。

## 日志与审计

1. 所有错误路径必须记录日志。
2. 敏感握手数据不输出明文，仅记录大小或状态。
3. 日志内容统一小写，避免额外格式化符号。

## 失败路径处理

1. SOCKS/MUX 失败必须返回错误码或 reset。
2. 失败后立即回收 stream、关闭 socket、停止定时器。
3. 严禁在运行时使用 `abort()` 终止进程。
