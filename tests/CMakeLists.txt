cmake_minimum_required(VERSION 3.16)

macro(add_socks_test NAME)
    add_executable(${NAME} ${NAME}.cpp)
    target_link_libraries(${NAME} PRIVATE
        socks_core
        GTest::gtest_main
        GTest::gmock_main
    )
    include(GoogleTest)
    gtest_discover_tests(${NAME} DISCOVERY_TIMEOUT 60)
endmacro()

add_socks_test(cert_manager_test)
add_socks_test(log_test)
add_socks_test(transcript_test)
add_socks_test(log_context_test)
add_socks_test(context_pool_test)
add_socks_test(reality_engine_test)
add_socks_test(ip_matcher_test)
add_socks_test(mux_codec_test)
add_socks_test(socks_codec_test)
add_socks_test(socks_session_test)
add_socks_test(crypto_util_test)
add_socks_test(router_test)
add_socks_test(domain_matcher_test)
add_socks_test(ch_parser_test)
add_socks_test(reality_messages_test)
add_socks_test(tls_record_layer_test)
add_socks_test(config_test)
add_socks_test(reflect_test)
add_socks_test(tls_key_schedule_test)
add_socks_test(socks_client_test)
add_socks_test(reality_fingerprint_test)
add_socks_test(reality_auth_test)
add_socks_test(mux_stream_test)
add_socks_test(mux_connection_test)
add_socks_test(mux_heartbeat_test)
target_compile_definitions(mux_heartbeat_test PRIVATE SPDLOG_ACTIVE_LEVEL=0)
add_socks_test(mux_dispatcher_test)
add_socks_test(replay_cache_test)
add_socks_test(upstream_test)
add_socks_test(cert_fetcher_test)
add_socks_test(key_rotator_test)
add_socks_test(socks_client_mock_test)
add_socks_test(socks_client_handshake_test)
add_socks_test(client_server_integration_test)
add_socks_test(connection_pool_test)
add_socks_test(limits_test)
add_socks_test(udp_integration_test)
add_socks_test(protocol_edge_test)
add_socks_test(socks_protocol_test)
add_socks_test(remote_server_test)
add_socks_test(remote_server_mux_test)
